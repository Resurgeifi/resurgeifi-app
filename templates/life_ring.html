{% extends "base.html" %}
{% block title %}Life Ring | Resurgifi{% endblock %}

{% block content %}
<div class="main-content" style="max-width: 700px; margin: 0 auto; text-align: center;">
  <h1>üõü Life Ring: Real-World Support</h1>

  <p class="mantra" style="margin-bottom: 2rem;">
    When virtual help isn't enough, we guide you toward a real-world hand. One question at a time.
  </p>

  <button onclick="startRescueFlow()" class="global-button" style="background-color: #e11d48;">
    Begin Rescue Check-In
  </button>

  <!-- üîÑ Rescue Modal Container -->
  <div id="rescueModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <p id="questionText" class="life-question">Loading...</p>
      <div id="responseButtons"></div>
    </div>
  </div>

  <!-- üéØ Final Match Display -->
  <div id="rescueResult" class="entry-box" style="display: none; margin-top: 3rem;">
    <h3 id="matchName">Rescue Ally</h3>
    <p><strong>Type:</strong> <span id="matchType">Integrated Recovery Support</span></p>
    <p><strong>Location:</strong> <span id="matchLocation">Undisclosed</span></p>
    <p id="matchQuote" style="font-style: italic;">‚ÄúThey show up when the world goes quiet.‚Äù</p>
    <div class="final-action-buttons">
      <a id="matchCall" class="global-button">üìû Call Now</a>
      <a id="matchVisit" class="global-button" target="_blank">üåê Visit Website</a>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
const rescueQuestions = [
  {
    key: "need",
    q: "What are you seeking help for?",
    options: ["Detox", "Mental Health", "Substance Use", "Grief / Loss", "Just Exploring"]
  },
  {
    key: "care_type",
    q: "What level of care do you think you need?",
    options: ["Inpatient", "Outpatient", "Not Sure"]
  },
  {
    key: "insurance",
    q: "Do you have insurance?",
    options: ["Yes", "No", "Not Sure"]
  },
  {
    key: "region",
    q: "Where are you located?",
    options: ["East Coast", "Midwest", "West Coast", "South", "Nationwide"]
  }
];

let currentStep = 0;
let userAnswers = {};

function startRescueFlow() {
  currentStep = 0;
  userAnswers = {};
  document.getElementById("rescueModal").style.display = "flex";
  showQuestion();
}

function showQuestion() {
  const qBlock = rescueQuestions[currentStep];
  if (!qBlock) {
    showRescueMatch();
    return;
  }

  document.getElementById("questionText").textContent = qBlock.q;
  const buttonArea = document.getElementById("responseButtons");
  buttonArea.innerHTML = "";

  qBlock.options.forEach(option => {
    const btn = document.createElement("button");
    btn.textContent = option;
    btn.className = "global-button";
    btn.style.margin = "0.5rem";
    btn.onclick = () => {
      userAnswers[qBlock.key] = option;
      currentStep++;
      showQuestion();
    };
    buttonArea.appendChild(btn);
  });
}

function showRescueMatch() {
  let match = {
    name: "Rescue Ally",
    type: "Integrated Recovery Support",
    location: "Undisclosed",
    quote: "They show up when the world goes quiet.",
    phone: "#",
    website: "#"
  };

  if (userAnswers.care_type === "Inpatient") {
    match = {
      name: "California Behavioral Health",
      type: "Inpatient Detox & Treatment",
      location: "Cathedral City, CA",
      quote: "They helped me detox safely and reminded me I still had a future.",
      phone: "tel:+18883551676",
      website: "https://cabehavioral.com/?src=resurgifi"
    };
  } else if (userAnswers.care_type === "Outpatient") {
    match = {
      name: "Engage Wellness",
      type: "Intensive Outpatient Program (IOP)",
      location: "Acton, MA",
      quote: "Engage gave me structure without walls. I felt supported and still got to rebuild life on the outside.",
      phone: "tel:+19786999786",
      website: "https://engagewellnessnow.com/?src=resurgifi"
    };
  }

  document.getElementById("rescueModal").style.display = "none";
  document.getElementById("rescueResult").style.display = "block";
  document.getElementById("matchName").textContent = match.name;
  document.getElementById("matchType").textContent = match.type;
  document.getElementById("matchLocation").textContent = match.location;
  document.getElementById("matchQuote").textContent = "‚Äú" + match.quote + "‚Äù";
  document.getElementById("matchCall").setAttribute("href", match.phone);
  document.getElementById("matchVisit").setAttribute("href", match.website);
}
</script>

<style>
.modal-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.modal-content {
  background: #f6e7c1;
  color: #1f3e36;
  padding: 2rem;
  border-radius: 14px;
  max-width: 90%;
  text-align: center;
  box-shadow: 0 0 15px #000;
}

.life-question {
  font-size: 1.4rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: #1f3e36;
}

#responseButtons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 1rem;
}

.final-action-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 1rem;
  margin-top: 1.5rem;
}

.final-action-buttons a {
  flex: 1 1 160px;
  text-align: center;
  max-width: 240px;
}
</style>
{% endblock %}





