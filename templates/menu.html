{% extends "base.html" %}
{% block title %}State of Inner | Resurgifi{% endblock %}

{% block content %}
<!-- ğŸ—¿ State of Inner Title Image -->
<img src="{{ url_for('static', filename='titles/stateofinner.png') }}" 
     alt="State of Inner Title" 
     style="display: block; max-width: 250px; margin: 2rem auto;" />

<!-- ğŸ” Inner Snapshot -->
<div class="container settings-page" style="text-align: center; margin-top: 2rem;">
  <h1>ğŸ“Š Your Current State</h1>

  <div class="card-dark" style="margin-top: 1.5rem; padding: 1.5rem;">
    <p><strong>ğŸŒ€ Current Ring:</strong> {{ current_ring or "Unranked" }}</p>

    <!-- ğŸ§­ Animated Days Count -->
    <p><strong>ğŸ“ˆ Days on Journey:</strong> 
      <span id="days-display">{{ days_on_journey or 0 }}</span> 
      day{{ 's' if (days_on_journey|int) != 1 else '' }}
    </p>

    <p><strong>ğŸ”¥ Streak:</strong> {{ streak or 0 }} day{{ 's' if (streak|int) != 1 else '' }}</p>
    <p><strong>ğŸ“ Journal Entries:</strong> {{ journal_count or 0 }}</p>
    <p><strong>ğŸ“… Last Journal Entry:</strong> {{ last_journal or "None yet" }}</p>
    <p><strong>ğŸ’¬ Last Circle Message:</strong></p>
    <p style="font-style: italic;">â€œ{{ last_circle_msg or 'No conversations yet' }}â€</p>
  </div>

  <!-- â³ Spin-Up Button -->
  <button id="calculate-days-btn" class="btn btn-outline-light" style="margin-top: 1.5rem;">
    â³ Calculate Time
  </button>

  <p class="mantra" style="margin-top: 2rem;">
    Every entry, every question, every pause... it all counts.
  </p>
</div>

<!-- ğŸ”Š Script: Level-Up Sound + Animated Day Counter -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("calculate-days-btn");
  const display = document.getElementById("days-display");
  if (!btn || !display) return;

  const target = parseInt(display.textContent) || 0;
  const audio = new Audio("/static/levelup.mp3");

  btn.addEventListener("click", () => {
    if (target === 0) return;
    audio.play();
    let counter = 0;
    const interval = setInterval(() => {
      if (counter < target) {
        counter++;
        display.textContent = counter;
      } else {
        clearInterval(interval);
      }
    }, 20);
  });
});
</script>
{% endblock %}
